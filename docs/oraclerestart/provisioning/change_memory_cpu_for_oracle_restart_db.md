# Change Memory and CPU allocation for an earlier provisioned Oracle Restart Database

In this use case, the Oracle Grid Infrastructure and Oracle Database are initially deployed automatically using Oracle Restart Controller. The responsefile is generated by the controller based on input parameters specified in the .yaml file. 

In this use case, the memory and cpu allocation for that existing Oracle Restart Database Pod is changed.

This example uses `oraclerestart_prov_nodeports.yaml` to provision the initial Oracle Restart Database using Oracle Restart Controller with:

* 1 Node Oracle Restart
* Headless services for Oracle Restart
  * Oracle Restart Node hostname
* Node Port 30007 mapped to port 1521 for Database Listener
* Persistent volumes created automatically based on specified disks for Oracle ASM storage
* Software Persistent Volume and Staged Software Persistent Volume using the specified location on the corresponding worker node.
* Namespace: `orestart`
* Staged Software location on the worker nodes is specified by `hostSwStageLocation`. The Grid Infrastructure and RDBMS Binaries are copied to this location on the worker node.
* Software location on the worker nodes is specified by `hostSwLocation`. The GI HOME and the RDBMS HOME in the Oracle Restart Pod will be mounted using this location on the worker node.


In this example, 
  * Oracle Restart Database Slim Image `localhost/oracle/database-orestart:19.3.0-slim` is used and it is built using files from [GitHub location](https://github.com/oracle/docker-images/tree/main/OracleDatabase/RAC/OracleRealApplicationClusters#building-oracle-rac-database-container-slim-image). Default image created using files from this project is `localhost/oracle/database-rac:19.3.0-slim`. You need to tag it with name `localhost/oracle/database-orestart:19.3.0-slim`. 
  * When you are building the image yourself, update the image value in the `oraclerestart_prov_nodeports.yaml` file to point to the container image you have built. 
  * The disks on the worker nodes for the Oracle Restart storage are `/dev/disk/by-partlabel/asm-disk1` and `/dev/disk/by-partlabel/asm-disk2`. 
  * Specify the size of these devices along with names using the parameter `storageSizeInGb`. Size is by-default in GBs.

**NOTE:** When no separate diskgroup names are specified for CRS Files, Database Files and Recovery Area Files, then the default diskgroup named `+DATA` is created from the disks specified by the parameter `crsAsmDeviceList`.

Use the file: [oraclerestart_prov_nodeports.yaml](./oraclerestart_prov_nodeports.yaml) for this use case as below:

1. Deploy the `oraclerestart_prov_nodeports.yaml` file:
    ```sh
    kubectl apply -f oraclerestart_prov_nodeports.yaml
    oraclerestart.database.oracle.com/oraclerestart-sample created
    ```
2. Check the status of the deployment:
    ```sh
    # Check the status of the Kubernetes Pods:    
    kubectl get all -n orestart

    # Check the logs of a particular pod. For example, to check status of pod "dbmc1-0":    
    kubectl exec -it pod/dbmc1-0 -n orestart -- bash -c "tail -f /tmp/orod/oracle_db_setup.log"
    ===============================
    ORACLE DATABASE IS READY TO USE
    ===============================
    ```
3. Refer to the page [Database Connection](./database_connection.md) for the details to connect to Oracle Restart Database deployed using above example.
4. Use the file: [oraclerestart_prov_nodeports_mcpu_change.yaml](./oraclerestart_prov_nodeports_mcpu_change.yaml) to change the Memory and CPU allocation for the existing Oracle Restart Database Pod:
    ```sh
    kubectl apply -f oraclerestart_prov_nodeports_mcpu_change.yaml
    oraclerestart.database.oracle.com/oraclerestart-sample configured
    ```
  
  You will notice that the exiting Oracle Restart Database Pod will be recreated with updated Memory and CPU allocation.

5. Check Details of Kubernetes CRD Object before and after the change as in this [example](./oraclerestart_prov_nodeports_mcpu_change.txt). It also has the details of the memory and cpu inside the pod before and after the change.